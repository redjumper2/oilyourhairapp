<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Oil Your Hair</title>
    <link rel="stylesheet" href="../css/products.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="/" class="logo">ðŸŒ¿ Oil Your Hair</a>
            <nav>
                <a href="/">Home</a>
                <a href="shop.html">Shop</a>
                <a href="admin/products.html">Admin</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search for oils, treatments..." />
        </div>

        <!-- Filters -->
        <div class="filters">
            <div class="filter-group">
                <label>
                    <input type="checkbox" name="category" value="oils" onchange="applyFilters()">
                    Oils
                </label>
                <label>
                    <input type="checkbox" name="category" value="treatments" onchange="applyFilters()">
                    Treatments
                </label>
                <label>
                    <input type="checkbox" name="type" value="coconut" onchange="applyFilters()">
                    Coconut
                </label>
                <label>
                    <input type="checkbox" name="type" value="argan" onchange="applyFilters()">
                    Argan
                </label>
                <label>
                    <input type="checkbox" name="organic" value="true" onchange="applyFilters()">
                    Organic Only
                </label>
            </div>
        </div>

        <!-- Products Grid Container -->
        <div id="productsContainer"></div>
    </div>

    <script src="../js/api/products-api.js"></script>
    <script src="../js/components/ProductGrid.js"></script>
    <script>
        // Initialize API and components
        const api = new ProductsAPI('http://localhost:9091', 'oilyourhair.com');
        const productGrid = new ProductGrid(document.getElementById('productsContainer'), api);

        // Load products on page load
        productGrid.load();

        // Search functionality
        let searchTimeout;
        document.getElementById('searchInput').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();

            if (query.length >= 2) {
                searchTimeout = setTimeout(async () => {
                    try {
                        const data = await api.searchProducts(query);
                        productGrid.products = data.products || [];
                        productGrid.render();
                    } catch (error) {
                        console.error('Search error:', error);
                    }
                }, 300);
            } else if (query.length === 0) {
                productGrid.load(getActiveFilters());
            }
        });

        // Filter functionality
        function getActiveFilters() {
            const filters = {};
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

            checkboxes.forEach(cb => {
                filters[cb.name] = cb.value;
            });

            return filters;
        }

        function applyFilters() {
            const filters = getActiveFilters();
            productGrid.load(filters);
        }
    </script>
</body>
</html>
